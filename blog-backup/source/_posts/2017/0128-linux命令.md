---
title: linux命令
date: 2017-01-28 10:30
updated: 2017-03-01 11:30  
categories: 笔记
tags: [Linux]  
keywords: Linux Shell 学习笔记  
description: 本文用于记录常用的Shell命令 #文章描述
---
<!--more-->
# 1.概述
- 目录的组织结构  
文件系统的组成元素是文件，目录是一种特殊的文件，目录中存放有关文件的信息。linux系统中可同时存在多种类型的文件系统。Linux系统启动时，选择一个分区作为根文件系统，其他分区的文件系统可根据
需要动态挂载至某个目录，其中`'/'`表示根目录，为了便于管理,每个目录中存放两个特殊的目录，分别表示当前目录`.`和父目录`..`

|目录名|内容描述|目录名|内容描述|
|:----|:------|:----:|:------|
|/bin  |所有用户可使用的可执行文件|/proc |基于内存的文件系统，用于显示内核信息|
|/sbin |系统管理员使用的执行文件|/lib  |共享库文件，供/bin和/sbin下的文件使用|
|/boot |Linux内核映像文件和与引导加载有关的文件|/etc  |系统配置文件|
|/dev  |所有设备文件，包括字符设备和块设备|/mnt  |挂载点，用于挂载文件系统|
|/usr  |/usr/bin|||

- Shell命令的分类  命令的语法结构如下 `命令名 [选项] [参数]`  
内部命令：由Shell实现，具有较高的执行效率，运行于当前进程，可使用`type  cd #判断cd`  
外部命令：指文件系统中的可执行二进制映像文件，Shell创建子进程加载并执行
  
```bash
man ls
info ls
ls --help
```
************************************

# 2.目录和文件操作
## 目录/文件操作
在linux系统中，目录是一种特殊的文件，其中包含了指向文件或子目录的链接信息 
 
- **pwd** 显示当前目录的绝对路径  
- **cd** 切换目录  
- **mkdir**  创建目录   `mkdir -p /demo/test`创建一系列目录  
- **ls** 显示文件和目录信息   

|选项|含义|选项|含义|
|:-:|:--:|:-:|:--:|
|-a|查询所有文件，包括`.`开头隐藏文件|-i|显示文件的i节点编号|
|-l|以详细列表的方式显示文件属性|-R|连同子目录内容一起列出|  

- **cp** 将原文件复制到目标文件
- **rm** 删除文件
- **mv** 将列表中的所有文件和目录移动到目标目录
- **find** `[目录列表] [匹配方式]`  

|匹配方式| 含义|匹配方式| 含义|
|:------|:--|:------|:--|
|-user usr | 显示所有属于`usr`的文件|-links +2/-2 |显示链接数大于2/小于2的文件|
|-type d/f|搜索类型 d:目录/f:文件|-size n  |匹配大小为n块的文件，c在n后标识字节数 |
|-print  |显示文件路径和名称 |-name `filename`|在目录列表中搜索和filename匹配的文件|
|-mtime n |匹配所有前n天修改过的文件|-exec `cmd` | 匹配的文件执行`cmd`命令，格式`cmd` {}\;|
|-atime n |匹配所有前n天访问过的文件|  |  
   
`find / -name build* ! -type d -exec ls -l {}\; #查找所有build开头的非目录文件并以详细列表方式显示`

## 显示文本文件内容
- **cat** 终端显示文本文件内容
- **more** 分页显示文本文件内容  
    `find / -name "*.c" -mtime -10 -print -exec more {} \; #分页显示10天内修改过的c程序`
- **less** -N 分页显示并加行号 PgDn/PgUp翻页
- head -n filename 显示文件前n行
- tail -n filename 显示文件尾n行

## 硬链接和软连接
- **硬链接**：在文件系统中，每个文件都与一个i节点对应，i节点记录了除文件名外文件的所有属性。对一个文件建立硬链接，就是仅复制
该文件的i节点，不包括文件的内容，同时将两者的链接计数加1。**由于不同文件系统的i节点结构不同，因此不能在不同的文件系统之间建立硬链接**  
    `ln sfile dfiel #对sfile建立硬链接文件dfile`  
- **软连接**：软连接又称为**符号连接**，符号文件的内容存储的是被连接文件的路径，因此符号链接可以跨越不同的文件系统  
`ln -s sfile dfile #对sfile建立符号链接文件dfile`  
************************************
************************************

# 3.用户和用户组管理  
 
## 用户的分类  
Linux可以建立多个用户，不同用户之间既有共享资源，又有各自独立的资源空间，并通过建立用户组来管理相关用户。  
每个用户都有一个唯一的标识`UID`，每个用户都有一个名字，例如超级用户`ROOT`，linux系统为了方便
使用，在用户名和`UID`之间建立一对一的关系，分为超级用户、虚拟用户、普通用户。  

- 超级用户：用于系统管理，可不加限制的使用系统资源，具有所有权限，用户名`root`，`UID`为0  
- 虚拟用户：为满足系统进程对文件资源的访问控制而建立，不能用于登录，例如`bin daemon adm lp`等，`UID`一般1~499  
- 普通用户：受限，可登陆系统，分享linux软硬件资源，用户`UID`在500~60000  

## 用户/用户组管理
用户组是若干用户的集合，一个用户可以属于多个用户组，其中一个是用户的主用户组，其他为附加用户组，
创建文件的用户成为该文件的属主用户，其用户组为该文件的属组，文件的属主用户和属组唯一。
用户管理过程中，所有用户、用户组和密码等信息都存放在/etc相关的文本文件中  

|文件|功能|文件|功能|
|:--|:--|:--:|:--|
|/etc/group|保存用户组信息|/home/username|用户`username`的主目录|
|/etc/passwd|保存用户名信息| /etc/shadow|保存用户的加密口令  |

- **groupadd** 添加用户组  
- **groupdel** 删除用户组  
- **groups** 显示用户所属的组  
- **passwd** 建立用户的登录密码  
- **useradd** 建立用户  

|选项| 含义| 选项| 含义|
|:--:|:--|:--:|:--|
|-g| 指定用户所属主用户组|-s| 指定用户登录shell|
|-G| 指定用户所属附加组|-u| 指定用户ID号|
|-n| 取消建立以用户名称为名的用户组|-m| 自动建立用户主目录|
|-r| 建立系统账号|-d| 指定用户主目录|
  


- **chown** 改变文件所属用户和组 
- **usermod** 修改用户属性  
    `usermod -s /bin/zsh usr1 #将usr1登陆shell改为zsh `  

|选项|含义|选项|含义|选项|含义|
|:--:|:--|:--:|:--|:--:|:--|
|-d|修改用户主目录|-G|修改用户附加用户组|-U|修改用户ID |
|-s|修改用户登陆shell|-g|修改用户主用户组|   | |  

************************************

# 4.文件的权限管理  
## 文件属性  
**权限**:`[文件所有者][文件所属组][其他用户]`  
未定义权限用`-`表示，若未设置则为0，三组分表代表文件所属用户、文件所属用户组和其他用户。 

|权限|字符表示|数字表示|文件|目录|
|:--|:--:|:--:|:--|:--|
|读|r|4|查看文件内容|浏览目录内容|
|写|w|2|修改文件内容|目录中创建目录或文件|
|执行|x|1|运行文件|进入目录|

- **文件类型/权限**  

|前缀|类型|前缀|类型|前缀|类型|
|:--:|:--|:--:|:--|:--:|:--|
|-| 普通文件|d|目录|p| 命名管道文件|
|b| 块设备文件|l|连接文件|c| 字符设备文件|

- **扩展权限的定义**  
除了上述系统为三类用户定义的三种权限外，有时系统对权限会有一些特殊的要求，例如，普通用户通过`passwd`命令修改密码时，
需临时使用户拥有特殊的权利，这需要在被执行命令文件中定义一些特殊的位，分别是`SUID,SGID,STICKY`  
    
    + Set-User-ID  
    SUID在文件上设置SUID位，用户在访问该文件时，临时拥有该文件属主用户的权限。
    例如修改用户登录密码是通过修改`/stc/shadow`文件来完成的。`ls -l /usr/bin/passwd`可看到  
    + Set-Group-ID  
    若某文件所属用户组为g，且该文件的SGID位被设置，当用户访问该文件时，用户将临时扮演用户组g中用户的角色，
    若在某目录上设置SGID位，则该目录中建立文件或目录的所属用户组为该目录的所属用户组
    + Sticky位  
    当前改位只对目录有效，若目录被设置为Sticky且用户在该目录上具有`'w'`和`'x'`权限，用户只能删除属于自己的
    文件或目录。例如，临时目录`/tmp`

|权限|特殊位含义|权限|特殊位含义|
|:-:|:-|:-:|:-|
|s|'x'+SUID|t|'x'+SGID|
|S|SUID|T|SGID|

## 权限修改
- chmod `[ugoa] [+-=] [rwxst] 文件列表`

|选项|功能|选项|功能|选项|功能|选项|功能|
|:-:|:--|:-:|:--|:-:|:--|:-:|:--|
|a|所有用户|u|属主用户|g|属主用户组|o|其他用户| 
|+|添加权限|-|删除权限|=|赋值权限| |     |


chmod命令可以8进制数值的形式定义权限，其中也包含特殊权限在内，共分四组，分别是特殊权限组、所属用户、所属用户组和其他用户
```bash
chmod  demo  # rw-rw-rw-
chmod6 demo  # rwSrw-rw-
chmod1 demo  # ---x--x--t
```

## 权限掩码
在linux系统中，系统为用户定义了umask掩码，umask是**进程**的一个属性，
目的是为进程创建的文件或目录定义默认权限，它是进程运行环境的一部分。用户登录系统后，
umask值在Shell的启动配置文件中定义，Shell创建的所有子孙都将继承这一属性。用户可通过umask命令修改值。  
以掩码值002为例，其二进制标识为`000 000 010`共9位，分别用于控制用户权限、控制用户组权限、控制其他用户权限。
若掩码中某位为1，则在创建文件或目录时，相应的权限位被屏蔽，但新建文件各组的执行权限除外(创建时都不赋予执行权限)  

|umask值|二进制标识|创建目录的权限|创建文件的权限|
|:-:|:-|:-:|:-:|
|022|000 010 010|755|644|
|027|000 000|750|640|
|002|000 000 010|755|644|
|006|000 000 110|771|660|
|007|000 000|770|660|      

```bash
umask nnn #nnn为权限掩码的值，范围：0000-0777  
umask  #显示当前的umask掩码
umask 002 #将当前Shell的umask掩码设置为002  
```

************************************
************************************

# 5.进程管理

 在linux系统中，init进程是所有进程的祖先，其进程标识为1，通过init进程实现应用环境的初始化，其中包括用户登陆终端。  

- pstree 显示系统中进程之间的继承关系  
- ps 显示系统中进程的状态和属性  
- fg 将指定作业号的进程从后台切换到前台  
- bg 将指定作业号的后台暂停进程继续运行  
- jobs 显示当前控制台中后台进程的状态  
- kill 根据PID向进程发送信号  

|选项|含义|选项|含义|选项|含义|
|:--|:-|:--:|:-|:--:|:-|
|-l|长列表|-e|显示所有进程|-j|按作业格式输出|
|-f|全格式|-r|只显示在运行进程|-u|打印用户格式，显示用户名|
|-a|显示终端用户进程(包括其他用户)|-x|显示没有控制终端的进程|||

|选项|含义|选项|含义|
|:--|:-|:--:|:-|
|S|可中断的睡眠状态|R|正在运行|
|D|不可中断的睡眠状态|T|停止状态|
|Z|僵死状态，进程已终止，但描述符仍存在|||

|进程PID|含义|进程PID|含义|
|:--|:-|:--:|:-|
|>0|将信号发送给标识为PID的进程|=0|正在运行|
|=-1|不可中断的睡眠状态|-n,n>1|停止状态|

```bash
$kill -s PID #s:signal(NO./NAME)
$kill -l #显示所有可用信号NAME
HUP INT QUIT ILL TRAP ABRT BUS FPE KILL USR1 SEGV USR2 PIPE ALRM TERM STKFLT CHLD 
CONT STOP TSTP TTIN TTOU URG XCPU XFSZ VTALRM PROF WINCH POLL PWR SYS
$kill -9 #发送信号9(KILL)到PID为323的进程
```

************************************
************************************

# 6.备份与恢复  

- dump/restore 面向文件系统的备份工具  
- dd 面向设备的备份与恢复  
- tar 将文件或目录归档至存储设备或文件，或恢复归档文件  
- gzip/bzip2  压缩与解压缩工具

|选项|含义|选项|含义|
|:--|:-|:--:|:-|
|-c|建立新的归档文件|-Z|调用compress处理归档|
|-x|从归档文件中解出文件|-r|归档文件末尾追加文件|
|-v|输出相关处理信息|-O|将文件解至标准输出|
|-z|用gzip处理归档文件|-t|查看归档文件中的文件|
|-j|用bzip2来处理归档文件|-f|对普通文件操作|

```bash
$tar cf /dev/fd0      # 将当前目录下的所有文件归档至软盘
$tar cf bak.tar /home # 将目录/home归档，然后用gzip压缩
$tar czvf bak.tar.gz  /home #将/home归档后用gzip压缩
$tar xzvf bak.tar.gz  # 先gzip解压后还原 
```

************************************
************************************

# 7.应用软件包管理
- rpm RedHat Package Management

|选项|含义|选项|含义|选项|含义|
|:--|:-|:--:|:-|:--:|:-|
|-i|安装软件包|-a|查询所有已安装包|-q|查询包|
|-h|显示安装进度|-l|查询包中文件列表|-e|卸载包|
|-v|验证包|-f|查询包含文件的包|-u|升级包|
|-i|查询详细信息|-s|显示包含文件的包|-p|查询软件包文件|

|文件类型|安装目录|文件类型|安装目录|
|:--|:-|:--:|:-|
|普通执行程序|/usr/bin|服务执行和管理程序|/usr/sbin|
|应用程序配置文件|/etc|应用程序文档文件|/usr/share/doc|
|应用程序手册文件|/usr/share/man|||    

************************************
************************************

# 8.输入输出重定向和管道
## 输入输出重定向

|文件|文件描述符|默认设备|
|:--|:--:|:--:|
|标准输入|0|键盘|
|标准输出|1|显示器|
|标准错误输出|2|显示器|

**输入重定向**   `命令 <输入文件 或 命令 0<输入文件`  
**输出重定向**   `命令 n>输出文件 或 命令 n>>输出文件`  

|数字n|含义|重定向符|含义|
|:--:|:--|:--:|:--|
|1|标准输出|>|输出覆盖至重定向文件|
|2|标准错误输出|>>|将输出内容追加至重定向文件|
|&|标准输出和标准错误输出|


## 管道
管道实现进程间通信，将两个进程的标准输入输出连接，分为无名管道和命名管道。  
无名管道：内存中建立文件描述，使用完后内存中的文件描述符被释放  
命名管道：文件系统中建立特殊的命名管道文件  
```bash
#无名管道  命令1|命令2|...|命令n
$cat file | grep 'pipe'|more     #分页显示file中包含"pipe"的所有行

#命名管道 mkfifo [选项] 文件名  选项同chmod
$mkfifo -m myfifo  #建立权限644的命名管道myfifo
$cat demo.c >myfifo    #相关到文件写入demo.c
$cat <myfifo           #从命名管道myfifo读取内容
```

************************************
************************************

# 9.通配符与正则表达式

## shell通配符
可以通过使用双引号或反斜杠屏蔽元字符含义  

|通配符|含义|通配符|含义|
|:--:|:--|:--:|:--|
|?|匹配任意一个字符|[a-z]|匹配方括号范围内任意一个字符|
|*|匹配任意数量字符|[!a-z]|匹配除了方括号范围内的一个字符|
|[abc]|匹配方括号中任意一个字符||

## 正则表达式
正则表达式是一个字符模板，用在文本处理程序中，搜索匹配的字符，这些文本处理程序
包括`ed,ex,vi,grep,egrep,sed,awk`等。  
grep 在文本文件中搜索匹配正则表达式的所有行  `grep [选项] 正则表达式 文本文件列表`  

|通配符|匹配字符|通配符|匹配字符|通配符|匹配字符|
|:--|:--|:--:|:--|:--:|:--|
|^|行首|$|行尾|\char|转义后面字符|
|[^]|不匹配方括号中任意字符|\<|单词的开始|\>|单词的结尾|
|`() or \(\)`|标记后面用到的匹配字符|`|or\|`|分组|`x\{m\}`|重复x字符m次|
|`x\{m,\}`|重复x字符至少m次|`x\{m,n\}`|重复x字符m次到n次|.|所有单个字符|

```bash
#在文件file中搜索以字符'n'开头的行
$grep '^n' file
#在文件file中搜索以".00"结尾的所有行
$grep '\.00$' file
#在文件file中搜索包含数字5，后面紧接字符'.'再后是任意一个字符的所有行
$grep '5\..' file
#在file中搜索以字符'w'或'y'开始的所有行
$grep '^[wy]' file
```



